<!DOCTYPE html>
<html lang="en" data-bs-theme="auto">

<head>
    <meta charset="utf-8">
    <title>Use CancellableTask in Giraffe</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="author" content="TheAngryByrd">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">

    <link rel="shortcut icon" type="image/x-icon" href="https://www.jimmybyrd.me/IcedTasks/img/favicon.ico">
    <link id="fsdocs-theme" type="text/css" rel="stylesheet" href="https://www.jimmybyrd.me/IcedTasks/content/fsdocs-dark.css" />
    <link type="text/css" rel="stylesheet" href="https://www.jimmybyrd.me/IcedTasks/content/fsdocs-main.css" />
    <link type="text/css" rel="stylesheet" href="https://www.jimmybyrd.me/IcedTasks/content/fsdocs-custom.css" />

    <script type="text/javascript" src="https://www.jimmybyrd.me/IcedTasks/content/theme-toggle.js">
        <!-- Placed in head to prevent flicker -->
    </script>

    <link type="text/css" rel="stylesheet" href="https://www.jimmybyrd.me/IcedTasks/content/navbar-fixed-left.css" />
    <!-- BEGIN SEARCH BOX: this adds support for the search box -->
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/JavaScript-autoComplete/1.0.4/auto-complete.css" />
    <!-- END SEARCH BOX: this adds support for the search box -->
    
</head>

<body>
    <nav class="navbar sticky-top navbar-expand-lg bg-body">
        <div class="container">
            <a class="navbar-brand" href="https://www.jimmybyrd.me/IcedTasks/"><img id="fsdocs-logo" src="https://www.jimmybyrd.me/IcedTasks/img/logo.png" /></a>
            <div id="header">
                <div class="searchbox">
                    <input data-search-input="" class="m-3" id="search-by" type="search" placeholder="Search..." />
                </div>
            </div>
            <div class="nav-item dropdown">
                <button class="btn btn-link nav-link py-2 px-0 px-lg-2 dropdown-toggle d-flex align-items-center"
                    id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown"
                    data-bs-display="static">

                    <i id="theme-icon-active" class="fa-solid fa-circle-half-stroke"></i>
                    <span class="d-none d-sm-none d-md-block ms-2">Toggle theme</span>
                </button>
                <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="bd-theme"
                    style="--bs-dropdown-min-width: 8rem;">
                    <li>
                        <button type="button" class="dropdown-item d-flex align-items-center"
                            data-bs-theme-value="light">
                            <i class="me-2  fa-solid fa-sun"></i>
                            Light
                            <i class="bi ms-auto d-none fa-solid fa-check"></i>
                        </button>
                    </li>
                    <li>
                        <button type="button" class="dropdown-item d-flex align-items-center active"
                            data-bs-theme-value="dark">
                            <i class="me-2  fa-regular fa-moon"></i>
                            Dark
                            <i class="bi ms-auto d-none fa-solid fa-check"></i>
                        </button>
                    </li>
                    <li>
                        <button type="button" class="dropdown-item d-flex align-items-center"
                            data-bs-theme-value="auto">
                            <i class="me-2 fa-solid fa-circle-half-stroke"></i>
                            Auto
                            <i class="bi ms-auto d-none fa-solid fa-check"></i>
                        </button>
                    </li>
                </ul>
            </div>

            <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"
                aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">

                <ul class="navbar-nav flex-wrap">
                    <li class="nav-item dropdown">
  <a class="nav-link dropdown-toggle" href="#" id="other-links" role="button" data-bs-toggle="dropdown"
    aria-expanded="false">
    Tutorials
  </a>
  <ul class="dropdown-menu" aria-labelledby="other-links">
    <li><a class="dropdown-item" href="https://www.jimmybyrd.me/IcedTasks/Tutorials/Tutorial-1.html">Tutorial 1</a></li>
<li><a class="dropdown-item" href="https://www.jimmybyrd.me/IcedTasks/Tutorials/Tutorial-3.html">A Literate Script</a></li>
<li><a class="dropdown-item" href="https://www.jimmybyrd.me/IcedTasks/Tutorials/Tutorial-2.html">Tutorial 2</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <a class="nav-link dropdown-toggle" href="#" id="other-links" role="button" data-bs-toggle="dropdown"
    aria-expanded="false">
    How To Guides
  </a>
  <ul class="dropdown-menu" aria-labelledby="other-links">
    <li><a class="dropdown-item" href="https://www.jimmybyrd.me/IcedTasks/How-To-Guides/Cancellable-Task-In-Falco.html">Use CancellableTask in Falco</a></li>
<li><a class="dropdown-item" href="https://www.jimmybyrd.me/IcedTasks/How-To-Guides/Cancellable-Task-In-Giraffe.html">Use CancellableTask in Giraffe</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <a class="nav-link dropdown-toggle" href="#" id="other-links" role="button" data-bs-toggle="dropdown"
    aria-expanded="false">
    Explanations
  </a>
  <ul class="dropdown-menu" aria-labelledby="other-links">
    <li><a class="dropdown-item" href="https://www.jimmybyrd.me/IcedTasks/Explanations/Explanation-1.html">Explanation 1</a></li>
  </ul>
</li>
                    <li class="nav-item dropdown">
  <a class="nav-link dropdown-toggle" href="#" id="other-links" role="button" data-bs-toggle="dropdown"
    aria-expanded="false">
    API Reference
  </a>
  <ul class="dropdown-menu" aria-labelledby="other-links">
    <li><a class="dropdown-item" href="https://www.jimmybyrd.me/IcedTasks/reference/index.html">All Namespaces</a></li>
  </ul>
</li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="project-references" role="button"
                            data-bs-toggle="dropdown" aria-expanded="false">
                            Project References
                        </a>
                        <ul class="dropdown-menu" aria-labelledby="other-links">
                            <li><a class="dropdown-item" href="https://github.com/TheAngryByrd/IcedTasks/blob/master/README.md"><i
                                        class="fa-brands fa-readme  pe-2"></i>README</a></li>
                            <li><a class="dropdown-item" href="https://github.com/TheAngryByrd/IcedTasks/blob/master/LICENSE.md"><i
                                        class="fa-regular  fa-id-card pe-2"></i>LICENSE</a></li>
                            <li><a class="dropdown-item" href="https://github.com/TheAngryByrd/IcedTasks/blob/master/CHANGELOG.md"><i
                                        class="fa-regular  fa-sticky-note pe-2"></i>CHANGELOG/Release
                                    Notes</a></li>
                            <li><a class="dropdown-item" href="IcedTasks"><i
                                        class="fa-brands fa-github pe-2"></i>Source Repository</a></li>

                        </ul>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="other-links" role="button"
                            data-bs-toggle="dropdown" aria-expanded="false">
                            Other Links
                        </a>
                        <ul class="dropdown-menu" aria-labelledby="other-links">
                            <li><a class="dropdown-item" href="https://docs.microsoft.com/en-us/dotnet/fsharp/"><i
                                        class="fa-brands fa-microsoft pe-2"></i>F# Documentation</a></li>
                            <li><a class="dropdown-item" href="https://fsharp.org/guides/slack/"><i
                                        class="fa-brands fa-slack pe-2"></i>F# Slack</a></li>
                            <li><a class="dropdown-item" href="https://discord.gg/R6n7c54/"><i
                                        class="fa-brands fa-discord pe-2"></i>F# Discord</a></li>
                            <li><a class="dropdown-item" href="http://foundation.fsharp.org/"><img
                                        src="https://fsharp.org/img/logo/fsharp.svg" Alt="FSharp Logo"
                                        class="fsharp-icon-logo pe-2"></i>F# Software Foundation</a></li>

                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container">
        <div class="masthead">
            <h3 class="muted"><a href="https://www.jimmybyrd.me/IcedTasks/">IcedTasks <small
                        class="muted">0.5.3</small></a></h3>
        </div>
        <div class="float-right" id="edit-this-page"><span><a class="nav-link"
                    href="https://github.com/TheAngryByrd/IcedTasks/edit/master/docsSrc/How-To-Guides/Cancellable-Task-In-Giraffe.fsx"><i
                        class="fa-regular fa-pen-to-square pe-2"></i>Edit this page</a></span></div>
        <hr />
    </div>
    <div class="container" id="fsdocs-content">
        
<h1><a name="How-to-use-CancellableTask-in-Giraffe" class="anchor" href="#How-to-use-CancellableTask-in-Giraffe">How to use CancellableTask in Giraffe</a></h1>
<p><a href="https://github.com/giraffe-fsharp/Giraffe/blob/master/DOCUMENTATION.md">See Giraffe Docs</a></p>
<p>To use a cancellableTask with Giraffe, we'll need to get the <a href="https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.http.httpcontext.requestaborted?view=aspnetcore-7.0">RequestAborted</a> property off the HttpContext.</p>
<p>We'll start off with a slightly longer version but then make a helper for this.</p>
<pre class="fssnip highlighted"><code lang="fsharp"><span class="c">// This just the dance to get Giraffe to compile for this example.</span>
<span class="c">// Really you&#39;d set up these references in an fsproj</span>
<span class="pp">#I</span> <span class="s">@&quot;C:\Program Files\dotnet\shared\Microsoft.AspNetCore.App\7.0.3&quot;</span>
<span class="pp">#r</span> <span class="s">&quot;Microsoft.AspNetCore.Http.Abstractions.dll&quot;</span>
<span class="pp">#r</span> <span class="s">&quot;Microsoft.Extensions.Logging.Abstractions.dll&quot;</span>
<span class="pp">#r</span> <span class="s">&quot;Microsoft.AspNetCore.Hosting.Abstractions.dll&quot;</span>
<span class="pp">#r</span> <span class="s">&quot;Microsoft.Extensions.DependencyInjection.Abstractions.dll&quot;</span>
<span class="pp">#r</span> <span class="s">&quot;Microsoft.Net.Http.Headers.dll&quot;</span>
<span class="pp">#r</span> <span class="s">&quot;nuget: Giraffe&quot;</span>
<span class="pp">#r</span> <span class="s">&quot;nuget: IcedTasks&quot;</span>

<span class="k">open</span> <span onmouseout="hideTip(event, 'fs1', 1)" onmouseover="showTip(event, 'fs1', 1)" class="id">Microsoft</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs2', 2)" onmouseover="showTip(event, 'fs2', 2)" class="id">AspNetCore</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs3', 3)" onmouseover="showTip(event, 'fs3', 3)" class="id">Http</span>
<span class="k">open</span> <span onmouseout="hideTip(event, 'fs4', 4)" onmouseover="showTip(event, 'fs4', 4)" class="id">System</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs5', 5)" onmouseover="showTip(event, 'fs5', 5)" class="id">Threading</span>
<span class="k">open</span> <span onmouseout="hideTip(event, 'fs4', 6)" onmouseover="showTip(event, 'fs4', 6)" class="id">System</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs5', 7)" onmouseover="showTip(event, 'fs5', 7)" class="id">Threading</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs6', 8)" onmouseover="showTip(event, 'fs6', 8)" class="id">Tasks</span>
<span class="k">open</span> <span onmouseout="hideTip(event, 'fs7', 9)" onmouseover="showTip(event, 'fs7', 9)" class="id">IcedTasks</span>
<span class="k">open</span> <span onmouseout="hideTip(event, 'fs8', 10)" onmouseover="showTip(event, 'fs8', 10)" class="id">Giraffe</span>

<span class="c">// This is a stand in for some real database call like Npgsql where it would take a CancellationToken</span>
<span class="k">type</span> <span class="rt">Database</span> <span class="o">=</span>
    <span class="k">static</span> <span class="k">member</span> <span class="fn">Get</span><span class="pn">(</span><span onmouseout="hideTip(event, 'fs9', 11)" onmouseover="showTip(event, 'fs9', 11)" class="fn">query</span><span class="pn">,</span> <span onmouseout="hideTip(event, 'fs10', 12)" onmouseover="showTip(event, 'fs10', 12)" class="fn">queryParams</span><span class="pn">,</span> <span onmouseout="hideTip(event, 'fs11', 13)" onmouseover="showTip(event, 'fs11', 13)" class="fn">cancellationToken</span><span class="pn">:</span> <span onmouseout="hideTip(event, 'fs12', 14)" onmouseover="showTip(event, 'fs12', 14)" class="vt">CancellationToken</span><span class="pn">)</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs13', 15)" onmouseover="showTip(event, 'fs13', 15)" class="k">task</span> <span class="pn">{</span>
        <span class="k">do!</span> <span onmouseout="hideTip(event, 'fs14', 16)" onmouseover="showTip(event, 'fs14', 16)" class="d">Task</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs15', 17)" onmouseover="showTip(event, 'fs15', 17)" class="id">Delay</span><span class="pn">(</span><span class="n">10</span><span class="pn">)</span>
    <span class="pn">}</span>


<span class="k">module</span> <span class="m">ExampleVerbose</span> <span class="o">=</span>


    <span class="c">// Some function that&#39;s doing the real handler&#39;s work</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs16', 18)" onmouseover="showTip(event, 'fs16', 18)" class="fn">myRealWork</span> <span onmouseout="hideTip(event, 'fs17', 19)" onmouseover="showTip(event, 'fs17', 19)" class="fn">next</span> <span onmouseout="hideTip(event, 'fs18', 20)" onmouseover="showTip(event, 'fs18', 20)" class="fn">ctx</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs19', 21)" onmouseover="showTip(event, 'fs19', 21)" class="k">cancellableTask</span> <span class="pn">{</span>
        <span class="c">// use a lamdbda to get the cancellableTask&#39;s current CancellationToken</span>
        <span class="k">let!</span> <span onmouseout="hideTip(event, 'fs20', 22)" onmouseover="showTip(event, 'fs20', 22)" class="fn">result</span> <span class="o">=</span>
            <span class="k">fun</span> <span onmouseout="hideTip(event, 'fs21', 23)" onmouseover="showTip(event, 'fs21', 23)" class="fn">ct</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs22', 24)" onmouseover="showTip(event, 'fs22', 24)" class="rt">Database</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs23', 25)" onmouseover="showTip(event, 'fs23', 25)" class="id">Get</span><span class="pn">(</span><span class="s">&quot;SELECT foo FROM bar where baz = @0&quot;</span><span class="pn">,</span> <span class="pn">[</span> <span class="s">&quot;@0&quot;</span><span class="pn">,</span> <span class="s">&quot;buzz&quot;</span> <span class="pn">]</span><span class="pn">,</span> <span onmouseout="hideTip(event, 'fs21', 26)" onmouseover="showTip(event, 'fs21', 26)" class="fn">ct</span><span class="pn">)</span>

        <span class="k">return!</span> <span onmouseout="hideTip(event, 'fs24', 27)" onmouseover="showTip(event, 'fs24', 27)" class="fn">json</span> <span class="fn">result</span> <span onmouseout="hideTip(event, 'fs17', 28)" onmouseover="showTip(event, 'fs17', 28)" class="fn">next</span> <span onmouseout="hideTip(event, 'fs18', 29)" onmouseover="showTip(event, 'fs18', 29)" class="fn">ctx</span>
    <span class="pn">}</span>

    <span class="c">// A helper to get the context&#39;s RequestAborted CancellationToken which will give the cancellableTask</span>
    <span class="c">// the context to pass long.</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs25', 30)" onmouseover="showTip(event, 'fs25', 30)" class="fn">myCustomHandler</span> <span onmouseout="hideTip(event, 'fs17', 31)" onmouseover="showTip(event, 'fs17', 31)" class="fn">next</span> <span class="pn">(</span><span onmouseout="hideTip(event, 'fs18', 32)" onmouseover="showTip(event, 'fs18', 32)" class="fn">ctx</span><span class="pn">:</span> <span onmouseout="hideTip(event, 'fs26', 33)" onmouseover="showTip(event, 'fs26', 33)" class="rt">HttpContext</span><span class="pn">)</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs13', 34)" onmouseover="showTip(event, 'fs13', 34)" class="k">task</span> <span class="pn">{</span>
        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs11', 35)" onmouseover="showTip(event, 'fs11', 35)" class="fn">cancellationToken</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs18', 36)" onmouseover="showTip(event, 'fs18', 36)" class="fn">ctx</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs26', 37)" onmouseover="showTip(event, 'fs26', 37)" class="id">RequestAborted</span>
        <span class="k">return!</span> <span onmouseout="hideTip(event, 'fs16', 38)" onmouseover="showTip(event, 'fs16', 38)" class="fn">myRealWork</span> <span onmouseout="hideTip(event, 'fs17', 39)" onmouseover="showTip(event, 'fs17', 39)" class="fn">next</span> <span onmouseout="hideTip(event, 'fs18', 40)" onmouseover="showTip(event, 'fs18', 40)" class="fn">ctx</span> <span onmouseout="hideTip(event, 'fs11', 41)" onmouseover="showTip(event, 'fs11', 41)" class="fn">cancellationToken</span>
    <span class="pn">}</span>

    <span class="c">// Some Giraffe App</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs27', 42)" onmouseover="showTip(event, 'fs27', 42)" class="fn">app</span><span class="pn">:</span> <span onmouseout="hideTip(event, 'fs28', 43)" onmouseover="showTip(event, 'fs28', 43)" class="fn">HttpFunc</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs26', 44)" onmouseover="showTip(event, 'fs26', 44)" class="rt">HttpContext</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs29', 45)" onmouseover="showTip(event, 'fs29', 45)" class="d">HttpFuncResult</span> <span class="o">=</span>
        <span onmouseout="hideTip(event, 'fs30', 46)" onmouseover="showTip(event, 'fs30', 46)" class="fn">route</span> <span class="s">&quot;/&quot;</span>
        <span class="o">&gt;</span><span class="o">=&gt;</span> <span onmouseout="hideTip(event, 'fs25', 47)" onmouseover="showTip(event, 'fs25', 47)" class="fn">myCustomHandler</span>
</code></pre>
<p>Now that we have the basic outline we can refactor this to make <code>myCustomHandler</code> take any <code>cancellableTask</code></p>
<pre class="fssnip highlighted"><code lang="fsharp"><span class="k">module</span> <span onmouseout="hideTip(event, 'fs31', 48)" onmouseover="showTip(event, 'fs31', 48)" class="m">ExampleRefactor1</span> <span class="o">=</span>
    <span class="c">// A helper to get the context&#39;s RequestAborted CancellationToken which will give the cancellableTask</span>
    <span class="c">// the context to pass long.</span>
    <span class="k">let</span> <span class="k">inline</span> <span onmouseout="hideTip(event, 'fs32', 49)" onmouseover="showTip(event, 'fs32', 49)" class="fn">cancellableHandler</span>
        <span class="pn">(</span><span onmouseout="hideTip(event, 'fs33', 50)" onmouseover="showTip(event, 'fs33', 50)" class="fn">cancellableHandler</span><span class="pn">:</span> <span onmouseout="hideTip(event, 'fs28', 51)" onmouseover="showTip(event, 'fs28', 51)" class="fn">HttpFunc</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs26', 52)" onmouseover="showTip(event, 'fs26', 52)" class="rt">HttpContext</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs12', 53)" onmouseover="showTip(event, 'fs12', 53)" class="vt">CancellationToken</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs14', 54)" onmouseover="showTip(event, 'fs14', 54)" class="d">Task</span><span class="pn">&lt;</span><span class="id">_</span><span class="pn">&gt;</span><span class="pn">)</span>
        <span class="pn">(</span><span onmouseout="hideTip(event, 'fs17', 55)" onmouseover="showTip(event, 'fs17', 55)" class="fn">next</span><span class="pn">:</span> <span onmouseout="hideTip(event, 'fs28', 56)" onmouseover="showTip(event, 'fs28', 56)" class="fn">HttpFunc</span><span class="pn">)</span>
        <span class="pn">(</span><span onmouseout="hideTip(event, 'fs18', 57)" onmouseover="showTip(event, 'fs18', 57)" class="fn">ctx</span><span class="pn">:</span> <span onmouseout="hideTip(event, 'fs26', 58)" onmouseover="showTip(event, 'fs26', 58)" class="rt">HttpContext</span><span class="pn">)</span>
        <span class="o">=</span>
        <span onmouseout="hideTip(event, 'fs13', 59)" onmouseover="showTip(event, 'fs13', 59)" class="k">task</span> <span class="pn">{</span> <span class="k">return!</span> <span onmouseout="hideTip(event, 'fs33', 60)" onmouseover="showTip(event, 'fs33', 60)" class="fn">cancellableHandler</span> <span onmouseout="hideTip(event, 'fs17', 61)" onmouseover="showTip(event, 'fs17', 61)" class="fn">next</span> <span onmouseout="hideTip(event, 'fs18', 62)" onmouseover="showTip(event, 'fs18', 62)" class="fn">ctx</span> <span onmouseout="hideTip(event, 'fs18', 63)" onmouseover="showTip(event, 'fs18', 63)" class="fn">ctx</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs26', 64)" onmouseover="showTip(event, 'fs26', 64)" class="id">RequestAborted</span> <span class="pn">}</span>

    <span class="c">// Some function that&#39;s doing the real handler&#39;s work</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs16', 65)" onmouseover="showTip(event, 'fs16', 65)" class="fn">myRealWork</span> <span onmouseout="hideTip(event, 'fs17', 66)" onmouseover="showTip(event, 'fs17', 66)" class="fn">next</span> <span onmouseout="hideTip(event, 'fs18', 67)" onmouseover="showTip(event, 'fs18', 67)" class="fn">ctx</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs19', 68)" onmouseover="showTip(event, 'fs19', 68)" class="k">cancellableTask</span> <span class="pn">{</span>
        <span class="c">// use a lamdbda to get the cancellableTask&#39;s current CancellationToken</span>
        <span class="k">let!</span> <span onmouseout="hideTip(event, 'fs20', 69)" onmouseover="showTip(event, 'fs20', 69)" class="fn">result</span> <span class="o">=</span>
            <span class="k">fun</span> <span onmouseout="hideTip(event, 'fs21', 70)" onmouseover="showTip(event, 'fs21', 70)" class="fn">ct</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs22', 71)" onmouseover="showTip(event, 'fs22', 71)" class="rt">Database</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs23', 72)" onmouseover="showTip(event, 'fs23', 72)" class="id">Get</span><span class="pn">(</span><span class="s">&quot;SELECT foo FROM bar where baz = @0&quot;</span><span class="pn">,</span> <span class="pn">[</span> <span class="s">&quot;@0&quot;</span><span class="pn">,</span> <span class="s">&quot;buzz&quot;</span> <span class="pn">]</span><span class="pn">,</span> <span onmouseout="hideTip(event, 'fs21', 73)" onmouseover="showTip(event, 'fs21', 73)" class="fn">ct</span><span class="pn">)</span>

        <span class="k">return!</span> <span onmouseout="hideTip(event, 'fs24', 74)" onmouseover="showTip(event, 'fs24', 74)" class="fn">json</span> <span class="fn">result</span> <span onmouseout="hideTip(event, 'fs17', 75)" onmouseover="showTip(event, 'fs17', 75)" class="fn">next</span> <span onmouseout="hideTip(event, 'fs18', 76)" onmouseover="showTip(event, 'fs18', 76)" class="fn">ctx</span>
    <span class="pn">}</span>


    <span class="c">// Some Giraffe App</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs27', 77)" onmouseover="showTip(event, 'fs27', 77)" class="fn">app</span><span class="pn">:</span> <span onmouseout="hideTip(event, 'fs28', 78)" onmouseover="showTip(event, 'fs28', 78)" class="fn">HttpFunc</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs26', 79)" onmouseover="showTip(event, 'fs26', 79)" class="rt">HttpContext</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs29', 80)" onmouseover="showTip(event, 'fs29', 80)" class="d">HttpFuncResult</span> <span class="o">=</span>
        <span onmouseout="hideTip(event, 'fs30', 81)" onmouseover="showTip(event, 'fs30', 81)" class="fn">route</span> <span class="s">&quot;/&quot;</span>
        <span class="o">&gt;</span><span class="o">=&gt;</span> <span onmouseout="hideTip(event, 'fs32', 82)" onmouseover="showTip(event, 'fs32', 82)" class="fn">cancellableHandler</span> <span onmouseout="hideTip(event, 'fs16', 83)" onmouseover="showTip(event, 'fs16', 83)" class="fn">myRealWork</span>
</code></pre>

        <div class="fsdocs-tip" id="fs1">namespace Microsoft</div>
<div class="fsdocs-tip" id="fs2">namespace Microsoft.AspNetCore</div>
<div class="fsdocs-tip" id="fs3">namespace Microsoft.AspNetCore.Http</div>
<div class="fsdocs-tip" id="fs4">namespace System</div>
<div class="fsdocs-tip" id="fs5">namespace System.Threading</div>
<div class="fsdocs-tip" id="fs6">namespace System.Threading.Tasks</div>
<div class="fsdocs-tip" id="fs7">namespace IcedTasks</div>
<div class="fsdocs-tip" id="fs8">namespace Giraffe</div>
<div class="fsdocs-tip" id="fs9">val query: &#39;a</div>
<div class="fsdocs-tip" id="fs10">val queryParams: &#39;b</div>
<div class="fsdocs-tip" id="fs11">val cancellationToken: CancellationToken</div>
<div class="fsdocs-tip" id="fs12">Multiple items<br />[&lt;Struct&gt;]
type CancellationToken =
  new: canceled: bool -&gt; unit
  member Equals: other: obj -&gt; bool + 1 overload
  member GetHashCode: unit -&gt; int
  member Register: callback: Action -&gt; CancellationTokenRegistration + 4 overloads
  member ThrowIfCancellationRequested: unit -&gt; unit
  member UnsafeRegister: callback: Action&lt;obj,CancellationToken&gt; * state: obj -&gt; CancellationTokenRegistration + 1 overload
  static member (&lt;&gt;) : left: CancellationToken * right: CancellationToken -&gt; bool
  static member (=) : left: CancellationToken * right: CancellationToken -&gt; bool
  member CanBeCanceled: bool
  member IsCancellationRequested: bool
  ...<br /><em>&lt;summary&gt;Propagates notification that operations should be canceled.&lt;/summary&gt;</em><br /><br />--------------------<br />CancellationToken ()<br />CancellationToken(canceled: bool) : CancellationToken</div>
<div class="fsdocs-tip" id="fs13">val task: TaskBuilder</div>
<div class="fsdocs-tip" id="fs14">Multiple items<br />type Task =
  interface IAsyncResult
  interface IDisposable
  new: action: Action -&gt; unit + 7 overloads
  member ConfigureAwait: continueOnCapturedContext: bool -&gt; ConfiguredTaskAwaitable
  member ContinueWith: continuationAction: Action&lt;Task,obj&gt; * state: obj -&gt; Task + 19 overloads
  member Dispose: unit -&gt; unit
  member GetAwaiter: unit -&gt; TaskAwaiter
  member RunSynchronously: unit -&gt; unit + 1 overload
  member Start: unit -&gt; unit + 1 overload
  member Wait: unit -&gt; unit + 5 overloads
  ...<br /><em>&lt;summary&gt;Represents an asynchronous operation.&lt;/summary&gt;</em><br /><br />--------------------<br />type Task&lt;&#39;TResult&gt; =
  inherit Task
  new: ``function`` : Func&lt;obj,&#39;TResult&gt; * state: obj -&gt; unit + 7 overloads
  member ConfigureAwait: continueOnCapturedContext: bool -&gt; ConfiguredTaskAwaitable&lt;&#39;TResult&gt;
  member ContinueWith: continuationAction: Action&lt;Task&lt;&#39;TResult&gt;,obj&gt; * state: obj -&gt; Task + 19 overloads
  member GetAwaiter: unit -&gt; TaskAwaiter&lt;&#39;TResult&gt;
  member WaitAsync: cancellationToken: CancellationToken -&gt; Task&lt;&#39;TResult&gt; + 2 overloads
  member Result: &#39;TResult
  static member Factory: TaskFactory&lt;&#39;TResult&gt;<br /><em>&lt;summary&gt;Represents an asynchronous operation that can return a value.&lt;/summary&gt;<br />&lt;typeparam name=&quot;TResult&quot;&gt;The type of the result produced by this &lt;see cref=&quot;T:System.Threading.Tasks.Task`1&quot; /&gt;.&lt;/typeparam&gt;</em><br /><br />--------------------<br />Task(action: System.Action) : Task<br />Task(action: System.Action, cancellationToken: CancellationToken) : Task<br />Task(action: System.Action, creationOptions: TaskCreationOptions) : Task<br />Task(action: System.Action&lt;obj&gt;, state: obj) : Task<br />Task(action: System.Action, cancellationToken: CancellationToken, creationOptions: TaskCreationOptions) : Task<br />Task(action: System.Action&lt;obj&gt;, state: obj, cancellationToken: CancellationToken) : Task<br />Task(action: System.Action&lt;obj&gt;, state: obj, creationOptions: TaskCreationOptions) : Task<br />Task(action: System.Action&lt;obj&gt;, state: obj, cancellationToken: CancellationToken, creationOptions: TaskCreationOptions) : Task<br /><br />--------------------<br />Task(``function`` : System.Func&lt;&#39;TResult&gt;) : Task&lt;&#39;TResult&gt;<br />Task(``function`` : System.Func&lt;obj,&#39;TResult&gt;, state: obj) : Task&lt;&#39;TResult&gt;<br />Task(``function`` : System.Func&lt;&#39;TResult&gt;, cancellationToken: CancellationToken) : Task&lt;&#39;TResult&gt;<br />Task(``function`` : System.Func&lt;&#39;TResult&gt;, creationOptions: TaskCreationOptions) : Task&lt;&#39;TResult&gt;<br />Task(``function`` : System.Func&lt;obj,&#39;TResult&gt;, state: obj, cancellationToken: CancellationToken) : Task&lt;&#39;TResult&gt;<br />Task(``function`` : System.Func&lt;obj,&#39;TResult&gt;, state: obj, creationOptions: TaskCreationOptions) : Task&lt;&#39;TResult&gt;<br />Task(``function`` : System.Func&lt;&#39;TResult&gt;, cancellationToken: CancellationToken, creationOptions: TaskCreationOptions) : Task&lt;&#39;TResult&gt;<br />Task(``function`` : System.Func&lt;obj,&#39;TResult&gt;, state: obj, cancellationToken: CancellationToken, creationOptions: TaskCreationOptions) : Task&lt;&#39;TResult&gt;</div>
<div class="fsdocs-tip" id="fs15">Task.Delay(delay: System.TimeSpan) : Task<br />Task.Delay(millisecondsDelay: int) : Task<br />Task.Delay(delay: System.TimeSpan, cancellationToken: CancellationToken) : Task<br />Task.Delay(millisecondsDelay: int, cancellationToken: CancellationToken) : Task</div>
<div class="fsdocs-tip" id="fs16">val myRealWork: next: HttpFunc -&gt; ctx: HttpContext -&gt; CancellableTask&lt;HttpContext option&gt;</div>
<div class="fsdocs-tip" id="fs17">val next: HttpFunc</div>
<div class="fsdocs-tip" id="fs18">val ctx: HttpContext</div>
<div class="fsdocs-tip" id="fs19">val cancellableTask: CancellableTaskBuilder</div>
<div class="fsdocs-tip" id="fs20">val result: unit</div>
<div class="fsdocs-tip" id="fs21">val ct: CancellationToken</div>
<div class="fsdocs-tip" id="fs22">type Database =
  static member Get: query: &#39;a * queryParams: &#39;b * cancellationToken: CancellationToken -&gt; Task&lt;unit&gt;</div>
<div class="fsdocs-tip" id="fs23">static member Database.Get: query: &#39;a * queryParams: &#39;b * cancellationToken: CancellationToken -&gt; Task&lt;unit&gt;</div>
<div class="fsdocs-tip" id="fs24">val json: dataObj: &#39;T -&gt; HttpFunc -&gt; ctx: HttpContext -&gt; HttpFuncResult<br /><em>&lt;summary&gt;
 Serializes an object to JSON and writes the output to the body of the HTTP response.
 It also sets the HTTP Content-Type header to application/json and sets the Content-Length header accordingly.
 The JSON serializer can be configured in the ASP.NET Core startup code by registering a custom class of type &lt;see cref=&quot;Json.ISerializer&quot; /&gt;.
 &lt;/summary&gt;<br />&lt;param name=&quot;dataObj&quot;&gt;The object to be send back to the client.&lt;/param&gt;<br />&lt;param name=&quot;ctx&quot;&gt;&lt;/param&gt;<br />&lt;typeparam name=&quot;&#39;T&quot;&gt;&lt;/typeparam&gt;<br />&lt;returns&gt;A Giraffe &lt;see cref=&quot;HttpHandler&quot; /&gt; function which can be composed into a bigger web application.&lt;/returns&gt;</em></div>
<div class="fsdocs-tip" id="fs25">val myCustomHandler: next: HttpFunc -&gt; ctx: HttpContext -&gt; Task&lt;HttpContext option&gt;</div>
<div class="fsdocs-tip" id="fs26"></div>
<div class="fsdocs-tip" id="fs27">val app: (HttpFunc -&gt; HttpContext -&gt; HttpFuncResult)</div>
<div class="fsdocs-tip" id="fs28">type HttpFunc = HttpContext -&gt; HttpFuncResult<br /><em>&lt;summary&gt;
 A HTTP function which takes an &lt;see cref=&quot;Microsoft.AspNetCore.Http.HttpContext&quot; /&gt; object and returns a &lt;see cref=&quot;HttpFuncResult&quot; /&gt;.
 The function may inspect the incoming &lt;see cref=&quot;Microsoft.AspNetCore.Http.HttpRequest&quot; /&gt; and make modifications to the &lt;see cref=&quot;Microsoft.AspNetCore.Http.HttpResponse&quot; /&gt; before returning a &lt;see cref=&quot;HttpFuncResult&quot; /&gt;. The result can be either a &lt;see cref=&quot;System.Threading.Tasks.Task&quot; /&gt; of Some HttpContext or a &lt;see cref=&quot;System.Threading.Tasks.Task&quot; /&gt; of None.
 If the result is Some HttpContext then the Giraffe middleware will return the response to the client and end the pipeline. However, if the result is None then the Giraffe middleware will continue the ASP.NET Core pipeline by invoking the next middleware.
 &lt;/summary&gt;</em></div>
<div class="fsdocs-tip" id="fs29">type HttpFuncResult = Task&lt;HttpContext option&gt;<br /><em>&lt;summary&gt;
 A type alias for &lt;see cref=&quot;System.Threading.Tasks.Task{HttpContext option}&quot; /&gt;  which represents the result of a HTTP function (HttpFunc).
 If the result is Some HttpContext then the Giraffe middleware will return the response to the client and end the pipeline. However, if the result is None then the Giraffe middleware will continue the ASP.NET Core pipeline by invoking the next middleware.
 &lt;/summary&gt;</em></div>
<div class="fsdocs-tip" id="fs30">val route: path: string -&gt; next: HttpFunc -&gt; ctx: HttpContext -&gt; HttpFuncResult<br /><em>&lt;summary&gt;
 Filters an incoming HTTP request based on the request path (case sensitive).
 &lt;/summary&gt;<br />&lt;param name=&quot;path&quot;&gt;Request path.&lt;/param&gt;<br />&lt;param name=&quot;next&quot;&gt;&lt;/param&gt;<br />&lt;param name=&quot;ctx&quot;&gt;&lt;/param&gt;<br />&lt;returns&gt;A Giraffe &lt;see cref=&quot;HttpHandler&quot; /&gt; function which can be composed into a bigger web application.&lt;/returns&gt;</em></div>
<div class="fsdocs-tip" id="fs31">module ExampleRefactor1

from Cancellable-Task-In-Giraffe</div>
<div class="fsdocs-tip" id="fs32">val cancellableHandler: cancellableHandler: (HttpFunc -&gt; HttpContext -&gt; CancellationToken -&gt; Task&lt;&#39;a&gt;) -&gt; next: HttpFunc -&gt; ctx: HttpContext -&gt; Task&lt;&#39;a&gt;</div>
<div class="fsdocs-tip" id="fs33">val cancellableHandler: (HttpFunc -&gt; HttpContext -&gt; CancellationToken -&gt; Task&lt;&#39;a&gt;)</div>

    </div>

    <!-- BEGIN SEARCH BOX: this adds support for the search box -->
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/JavaScript-autoComplete/1.0.4/auto-complete.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.3.0/css/all.min.css"
        integrity="sha512-SzlrxWUlpfuzQ+pcUCosxcglQRNAq/DZjVsC0lE40xsADsfeQoEypE+enwcOiGjk/bSuGGKHEyjSoQ1zVisanQ=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script type="text/javascript">var fsdocs_search_baseurl = 'https://www.jimmybyrd.me/IcedTasks/';</script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/lunr.js/2.3.8/lunr.min.js"></script>
    <script type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/JavaScript-autoComplete/1.0.4/auto-complete.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN"
        crossorigin="anonymous"></script>

    <script type="text/javascript" async
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"></script>

    <script type="text/javascript" src="https://www.jimmybyrd.me/IcedTasks/content/fsdocs-search.js"></script>
    <script type="text/javascript" src="https://www.jimmybyrd.me/IcedTasks/content/fsdocs-tips.js"></script>

    <!-- END SEARCH BOX: this adds support for the search box -->
    </div>
</body>

</html>